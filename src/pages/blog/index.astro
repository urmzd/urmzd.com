---
import BaseLayout from '@/layouts/BaseLayout.astro';
import BlogSearch from '@/components/BlogSearch';
import { getCollection } from 'astro:content';
import { calculateReadTime } from '@/lib/readTime';

const posts = await getCollection('blog');
const sortedPosts = posts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .map((post) => ({
    id: post.id,
    title: post.data.title,
    description: post.data.description,
    pubDate: post.data.pubDate.toISOString(),
    readTime: calculateReadTime(post.body || "").text,
  }));
---

<BaseLayout title="Blog - urmzd">
  <main class="container mx-auto px-4 pt-24 pb-16">
    <h1 class="mb-8 text-4xl font-bold">Blog</h1>
    <BlogSearch posts={sortedPosts} client:load />
  </main>
</BaseLayout>
